//This file acts as a contract between the client and server,
// describing both the structure of the data and the remote procedure calls (RPCs)
// they use to communicate.

syntax = "proto3";
package grpc;

option go_package = "Disys_Mandatory-Activity-5/grpc";

service AuctionServer {
  //Method:  bid
  //Inputs:  amount (an int)
  //Outputs: ack
  //Comment: given a bid, returns an outcome among {fail, success or exception}
  rpc Bid(BidEntry) returns (Reply);

  //Method:  result
  //Inputs:  void
  //Outputs: outcome
  //Comment: if the auction is over, it returns the result, else highest bid.
  rpc Result(Reply) returns (Outcome);

  // Method
  //Comment: Sends accepted bid to followers, and waits for a majority of acknowledges
  rpc ReplicateBid(BidEntry) returns (Reply);

  //When a follower detects a timeout ( doesnt recieve ack after sending)
  //Send a message to all other servers, that we appoint a new leader
  rpc AnnounceNewLeader(LeaderInfo) returns (Reply);

  rpc HeartBeat(Reply) returns (Reply);


}

message Outcome {
  string result = 1;
  int32 highestBid = 2;
  string highestBidder = 3;
}

message Reply{
}


message BidEntry {
  int32 amount = 1;
  string bidder = 2;
  int32 timestamp = 3;
  int64 seqNo = 4; // -1 until accepted into the bid sequence. Then updated to seq number
}

message LeaderInfo {
  string leaderAddr = 1;
  int32 leaderId = 2;
}